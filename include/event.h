#ifndef __KIRC_EVENT_H
#define __KIRC_EVENT_H

#include "kirc.h"

typedef enum {
    EVENT_NONE = 0,
    EVENT_EXT_CAP,
    EVENT_EXT_AUTHENTICATE,
    EVENT_JOIN,
    EVENT_MODE,
    EVENT_NICK,
    EVENT_NOTICE,
    EVENT_PART,
    EVENT_PING,
    EVENT_PRIVMSG,
    EVENT_QUIT,
    EVENT_TOPIC,
    EVENT_001_RPL_WELCOME,
    EVENT_002_RPL_YOURHOST,
    EVENT_003_RPL_CREATED,
    EVENT_004_RPL_MYINFO,
    EVENT_005_RPL_BOUNCE,
    EVENT_042_RPL_YOURID,
    EVENT_200_RPL_TRACELINK,
    EVENT_201_RPL_TRACECONNECTING,
    EVENT_202_RPL_TRACEHANDSHAKE,
    EVENT_203_RPL_TRACEUNKNOWN,
    EVENT_204_RPL_TRACEOPERATOR,
    EVENT_205_RPL_TRACEUSER,
    EVENT_206_RPL_TRACESERVER,
    EVENT_207_RPL_TRACESERVICE,
    EVENT_208_RPL_TRACENEWTYPE,
    EVENT_209_RPL_TRACECLASS,
    EVENT_211_RPL_STATSLINKINFO,
    EVENT_212_RPL_STATSCOMMANDS,
    EVENT_213_RPL_STATSCLINE,
    EVENT_215_RPL_STATSILINE,
    EVENT_216_RPL_STATSKLINE,
    EVENT_218_RPL_STATSYLINE,
    EVENT_219_RPL_ENDOFSTATS,
    EVENT_250_RPL_STATSCONN,
    EVENT_251_RPL_LUSERCLIENT,
    EVENT_252_RPL_LUSEROP,
    EVENT_253_RPL_LUSERUNKNOWN,
    EVENT_254_RPL_LUSERCHANNELS,
    EVENT_255_RPL_LUSERME,
    EVENT_265_RPL_LOCALUSERS,
    EVENT_266_RPL_GLOBALUSERS,
    EVENT_301_RPL_AWAY,
    EVENT_328_RPL_CHANNEL_URL,
    EVENT_332_RPL_TOPIC,
    EVENT_333_RPL_TOPICWHOTIME,
    EVENT_353_RPL_NAMREPLY,
    EVENT_366_RPL_ENDOFNAMES,
    EVENT_372_RPL_MOTD,
    EVENT_375_RPL_MOTDSTART,
    EVENT_376_RPL_ENDOFMOTD,
    EVENT_396_RPL_HOSTHIDDEN,
    EVENT_400_ERR_UNKNOWNERROR,
    EVENT_401_ERR_NOSUCHNICK,
    EVENT_402_ERR_NOSUCHSERVER,
    EVENT_403_ERR_NOSUCHCHANNEL,
    EVENT_404_ERR_CANNOTSENDTOCHAN,
    EVENT_405_ERR_TOOMANYCHANNELS,
    EVENT_406_ERR_WASNOSUCHNICK,
    EVENT_407_ERR_TOOMANYTARGETS,
    EVENT_408_ERR_NOSUCHSERVICE,
    EVENT_409_ERR_NOORIGIN,
    EVENT_411_ERR_NORECIPIENT,
    EVENT_412_ERR_NOTEXTTOSEND,
    EVENT_413_ERR_NOTOPLEVEL,
    EVENT_414_ERR_WILDTOPLEVEL,
    EVENT_415_ERR_BADMASK,
    EVENT_421_ERR_UNKNOWNCOMMAND,
    EVENT_422_ERR_NOMOTD,
    EVENT_423_ERR_NOADMININFO,
    EVENT_424_ERR_FILEERROR,
    EVENT_431_ERR_NONICKNAMEGIVEN,
    EVENT_432_ERR_ERRONEUSNICKNAME,
    EVENT_433_ERR_NICKNAMEINUSE,
    EVENT_436_ERR_NICKCOLLISION,
    EVENT_441_ERR_USERNOTINCHANNEL,
    EVENT_442_ERR_NOTONCHANNEL,
    EVENT_443_ERR_USERONCHANNEL,
    EVENT_444_ERR_NOLOGIN,
    EVENT_445_ERR_SUMMONDISABLED,
    EVENT_446_ERR_USERSDISABLED,
    EVENT_465_ERR_YOUREBANNEDCREEP,
    EVENT_900_RPL_LOGGEDIN,
    EVENT_901_RPL_LOGGEDOUT,
    EVENT_902_ERR_NICKLOCKED,
    EVENT_903_RPL_SASLSUCCESS,
    EVENT_904_ERR_SASLFAIL,
    EVENT_905_ERR_SASLTOOLONG,
    EVENT_906_ERR_SASLABORTED,
    EVENT_907_ERR_SASLALREADY,
    EVENT_908_RPL_SASLMECHS
} event_type_t;

typedef struct {
    const char *command;
    event_type_t type;
} event_map_t;

static const event_map_t event_map[] = {
    { "CAP",     EVENT_EXT_CAP },
    { "JOIN",    EVENT_JOIN },
    { "MODE",    EVENT_MODE },
    { "NICK",    EVENT_NICK },
    { "NOTICE",  EVENT_NOTICE },
    { "PART",    EVENT_PART },
    { "PING",    EVENT_PING },
    { "PRIVMSG", EVENT_PRIVMSG },
    { "QUIT",    EVENT_QUIT },
    { "TOPIC",   EVENT_TOPIC },
    { "001",     EVENT_001_RPL_WELCOME },
    { "002",     EVENT_002_RPL_YOURHOST },
    { "003",     EVENT_003_RPL_CREATED },
    { "004",     EVENT_004_RPL_MYINFO },
    { "005",     EVENT_005_RPL_BOUNCE },
    { "042",     EVENT_042_RPL_YOURID },
    { "200",     EVENT_200_RPL_TRACELINK },
    { "201",     EVENT_201_RPL_TRACECONNECTING },
    { "202",     EVENT_202_RPL_TRACEHANDSHAKE },
    { "203",     EVENT_203_RPL_TRACEUNKNOWN },
    { "204",     EVENT_204_RPL_TRACEOPERATOR },
    { "205",     EVENT_205_RPL_TRACEUSER },
    { "206",     EVENT_206_RPL_TRACESERVER },
    { "207",     EVENT_207_RPL_TRACESERVICE },
    { "208",     EVENT_208_RPL_TRACENEWTYPE },
    { "209",     EVENT_209_RPL_TRACECLASS },
    { "211",     EVENT_211_RPL_STATSLINKINFO },
    { "212",     EVENT_212_RPL_STATSCOMMANDS },
    { "213",     EVENT_213_RPL_STATSCLINE},
    { "215",     EVENT_215_RPL_STATSILINE },
    { "216",     EVENT_216_RPL_STATSKLINE },
    { "218",     EVENT_218_RPL_STATSYLINE },
    { "219",     EVENT_219_RPL_ENDOFSTATS },
    { "250",     EVENT_250_RPL_STATSCONN },
    { "251",     EVENT_251_RPL_LUSERCLIENT },
    { "252",     EVENT_252_RPL_LUSEROP },
    { "253",     EVENT_253_RPL_LUSERUNKNOWN },
    { "254",     EVENT_254_RPL_LUSERCHANNELS },
    { "255",     EVENT_255_RPL_LUSERME },
    { "265",     EVENT_265_RPL_LOCALUSERS },
    { "266",     EVENT_266_RPL_GLOBALUSERS },
    { "301",     EVENT_301_RPL_AWAY },
    { "328",     EVENT_328_RPL_CHANNEL_URL },
    { "332",     EVENT_332_RPL_TOPIC },
    { "333",     EVENT_333_RPL_TOPICWHOTIME },
    { "353",     EVENT_353_RPL_NAMREPLY },
    { "366",     EVENT_366_RPL_ENDOFNAMES },
    { "375",     EVENT_375_RPL_MOTDSTART },
    { "372",     EVENT_372_RPL_MOTD },
    { "376",     EVENT_376_RPL_ENDOFMOTD },
    { "396",     EVENT_396_RPL_HOSTHIDDEN },
    { "400",     EVENT_400_ERR_UNKNOWNERROR },
    { "401",     EVENT_401_ERR_NOSUCHNICK },
    { "402",     EVENT_402_ERR_NOSUCHSERVER },
    { "403",     EVENT_403_ERR_NOSUCHCHANNEL },
    { "404",     EVENT_404_ERR_CANNOTSENDTOCHAN },
    { "405",     EVENT_405_ERR_TOOMANYCHANNELS },
    { "406",     EVENT_406_ERR_WASNOSUCHNICK },
    { "407",     EVENT_407_ERR_TOOMANYTARGETS },
    { "408",     EVENT_408_ERR_NOSUCHSERVICE },
    { "409",     EVENT_409_ERR_NOORIGIN },
    { "411",     EVENT_411_ERR_NORECIPIENT },
    { "412",     EVENT_412_ERR_NOTEXTTOSEND },
    { "413",     EVENT_413_ERR_NOTOPLEVEL },
    { "414",     EVENT_414_ERR_WILDTOPLEVEL },
    { "415",     EVENT_415_ERR_BADMASK },
    { "421",     EVENT_421_ERR_UNKNOWNCOMMAND },
    { "422",     EVENT_422_ERR_NOMOTD },
    { "423",     EVENT_423_ERR_NOADMININFO },
    { "424",     EVENT_424_ERR_FILEERROR },
    { "431",     EVENT_431_ERR_NONICKNAMEGIVEN },
    { "432",     EVENT_432_ERR_ERRONEUSNICKNAME },
    { "433",     EVENT_433_ERR_NICKNAMEINUSE },
    { "436",     EVENT_436_ERR_NICKCOLLISION },
    { "441",     EVENT_441_ERR_USERNOTINCHANNEL },
    { "442",     EVENT_442_ERR_NOTONCHANNEL },
    { "443",     EVENT_443_ERR_USERONCHANNEL },
    { "444",     EVENT_444_ERR_NOLOGIN },
    { "445",     EVENT_445_ERR_SUMMONDISABLED },
    { "446",     EVENT_446_ERR_USERSDISABLED },
    { "465",     EVENT_465_ERR_YOUREBANNEDCREEP },
    { "900",     EVENT_900_RPL_LOGGEDIN },
    { "901",     EVENT_901_RPL_LOGGEDOUT },
    { "902",     EVENT_902_ERR_NICKLOCKED },
    { "903",     EVENT_903_RPL_SASLSUCCESS },
    { "904",     EVENT_904_ERR_SASLFAIL },
    { "905",     EVENT_905_ERR_SASLTOOLONG },
    { "906",     EVENT_906_ERR_SASLABORTED },
    { "907",     EVENT_907_ERR_SASLALREADY },
    { "908",     EVENT_908_RPL_SASLMECHS },
    { NULL,      EVENT_NONE }
};

typedef struct {
    kirc_t *ctx;
    char raw[RFC1459_MESSAGE_MAX_LEN];
    char channel[RFC1459_CHANNEL_MAX_LEN];
    char message[RFC1459_MESSAGE_MAX_LEN];
    char command[RFC1459_MESSAGE_MAX_LEN];
    char nickname[RFC1459_MESSAGE_MAX_LEN];
    char params[RFC1459_MESSAGE_MAX_LEN];
    event_type_t type;
} event_t;

int event_init(event_t *event, kirc_t *ctx);
int event_parse(event_t *event, char *line);

#endif  // __KIRC_EVENT_H
